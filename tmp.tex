\section{Принцип Дирихле}

Предположим, что у нас есть $n$ клеток и $n+1$ голубь и мы рассадили голубей по клеткам. Довольно очевидно, что в одной из клеток окажется по крайней мере два голубя. Впервые это тривиальные наблюдение сделал и начал использовать в математике немецкий математик Дирихле в XIX веке. С тех пор это наблюдение называется в России <<принципом Дирихле>>, а за пределами бывшего СССР <<принципом голубиных гнёзд>> (pigeonhole principle). Прежде чем перейти к более сложным примерам применения этих принципов, переформулируем утверждение на языке множеств.

\begin{thm}
Пусть $A$ и $B$ такие множества, что $|A|>|B|$, и дана функция $f:A\to B$. Тогда функция $f$ не является инъективной.
\end{thm}
\begin{proof}
Для инъективной функции $|f(A)| = |A|$, однако в нашем случае это противоречит условию $|A|>|B|$, поскольку $f(A)\subset B$.
\end{proof}

\begin{exercise}
Утверждение принципа Дирихле тривиально в терминах множеств и отображений. А сможете ли вы доказать этот принцип, используя только аксиоматику Пеано?
\end{exercise}

Введем обозначение $\lceil {m\over n} \rceil = \min\{k|kn\ge m\}$. Эта операция называется \term{потолок} и интуитивно представляет собой результат деления $m$ на $n$ с округлением в большую сторону: если число не делится без остатка, то к частному прибавляется единица.

\begin{exercise}
Пусть теперь у нас $m$ голубей и $n$ клеток. Докажите, что в одной из клеток окажется по крайней мере $\lceil{m\over n}\rceil$. Эта теорема называется \term{обобщённым принципом Дирихле}.
\end{exercise}

Рассмотрим теперь ряд простых применений принципа Дирихле. Частично они позаимствованы из Википедии, частично из замечательной книги <<A Walk Through Combinatorics>>.

\begin{example}
Пусть в ящике лежит большое число белых, чёрных и красных носков. Когда мы вытаскиваем носок, мы не видим его цвет до тех пор, пока не вытащим его. Сколько надо достать носков, прежде чем мы гарантированно получим пару одного цвета?
\end{example}

Пусть множество $A$~--- это те носки, которые мы достали из ящика. Пусть далее множество $B$~--- это множество цветов носков. В нашем случае $|B|=3$. Каждый носок имеет цвет, что соответствует отображению $f:A\to B$. В задаче требуется, чтобы у нас минимум два носка обладали одним цветом, то есть чтобы функция $f$ не была инъективной. По принципу Дирихле это достигается когда $|A|>|B|$. Таким образом нам достаточно взять $$|A|=|B|+1 = 4$$ носков для того, чтобы гарантированно найти пару одинаковых цветов.

\begin{exercise}
На праздник пришло $n$ человек. Какие-то из этих людей поздоровались за руку. Докажите, что всегда найдётся такая пара людей, которые совершили одинаковое число рукопожатий.
\end{exercise}

Данное утверждение называется <<леммой о рукопожатиях>> и может быть сформулировано более абстрактно для графов:

\begin{definition}
\term{Степенью} вершины графа называется число рёбер, инцидентных ей.
\end{definition}

\begin{HandshakesLemma}
В любом графе найдутся две вершины с одинаковой степенью.
\end{HandshakesLemma}

\begin{example}
Давайте докажем, что в Москве найдётся по крайней мере два человека с одинаковым числом волос на голове.

Пусть $A$~--- множество жителей Москвы, $B$~--- множество чисел, соответствующих возможному числу волос на голове. Точно мы это множество определить видимо не можем, но по крайней мере можем дать грубую оценку $|B|<1000000$. Однако жителей Москвы явно больше. Опять же мы не знаем этого точно, но крайней мере $|A|>1000000$, откуда следует то отображение $A\to B$ не может быть инъективным и найдутся два жителя с одинаковым числом волос.
\end{example}

\begin{example}
Рассмотрим последовательность чисел 1, 11, 111, 1111, $\ldots$ и докажем, что в этой последовательности найдётся число, которое делится на 123.

Вначале обозначим элементы этой последовательности как $a_i$ и заметим, что их можно записать как
$a_i = \sum_{k=0}^{i-1}10^k$

Предположим теперь, что числа, которое делится на 123, в этой последовательности нет. Рассмотрим тогда последовательность остатков от деления на 123 элементов этой последовательности:
$$1, 11, 111, 4, 41, 42, 52, 29, \ldots$$

В этой последовательности обязательно найдутся два одинаковых числа, поскольку остаток от деления на 123 может максимум равняться 122, поэтому по принципу Дирихле уже среди первых 123 элементов мы встретим повторение. Пусть это будут остатки от деления чисел $a_i$ и $a_j$ на 123 (для определённости пусть $i>j$), которые мы обозначим за $r$:
$$a_i = 123q_i + r$$
$$a_j = 123q_j + r$$
Вычтя из первого равенства второе, имеем
\begin{equation}\label{np:1}
a_i - a_j = 123(q_i - q_j)
\end{equation}
Однако если вспомнить определение $a_i$ то легко увидеть, что
\begin{align*}
a_i - a_j &= \sum_{k=0}^{i-1}10^k - \sum_{k=0}^{j-1}10^k \\&= \sum_{k=j}^{i-1}10^k \\&= 10^j\sum_{k=0}^{i-j}10^k \\&= 10^j a_{i-j}
\end{align*}
Сопоставляя это с \eqref{np:1}, получаем
$$10^j a_{i-j} = 123(q_i - q_j)$$
Здесь правая часть делится на 123, а значит на 123 должна делится и левая часть. Однако $10^j$ и $a_{i-j}$ взаимопросты и более того $10^j$ не делится на 123. Отсюда следует, что $123|a_{i-j}$, что и требовалось.
\end{example}

\begin{example}
Докажем, что за последнюю тысячу лет у читателя был такой предок $A$, который одновременно является предком и отца и матери некоторого другого предка $P$ читателя.

У читателя есть отец и мать (2 человека). У них у каждого так же в свою очередь есть по отцу и матери~--- это дедушки и бабушки читателя, всего их $4=2^2$ человека. У них в свою очередь есть свои мамы и папы (прабабушки и прадедушки), которых всего $8=2^3$ человек. Легко увидеть закономерность: $i$-е поколение предков читателя состоит из $2^i$ человек. Если грубо предположить, что поколения сменяются каждые 25 лет, то за 1000 лет поколения успели смениться 40 раз, и того за 1000 лет читатель имел
$$\sum_{i=1}^{40} 2^i = 2^{41} - 1$$
предков. Последнее равенство легко следует из свойств двоичной системы счисления (проверьте!).

В то же время население нашей планеты в данный момент меньше чем $10^{10}$, а в прошлые года оно было ещё меньше. Как самая грубая верхняя оценка количества людей живущих на земле в последнюю 1000 лет можно взять величину $40\cdot 10^10$~--- она намного выше реального количества людей, проживавших на земле, но однако даже эта оценка не превосходит величины $2^{41} - 1$, в чём легко убедиться, взяв в руки калькулятор.

Рассуждение будет понятнее, если посмотреть на генеалогическое дерево на рисунке~3.3.

\begin{figure}[h]
\centering
\begin{tikzpicture}
\def\point{node [circle, draw, fill, inner sep = 0, minimum size = .1cm] }
\draw (0, 0) \point (p0) {};
\draw (-1cm, .5cm) \point (p1) {};
\draw (1cm, .5cm) \point (p2) {};
\draw (-1.5cm, 1cm) \point (p3) {};
\draw (-.5, 1cm) \point (p4) {};
\draw (.5cm, 1cm) \point (p5) {};
\draw (1.5cm, 1cm) \point (p6) {};
\draw (-1.7cm, 1.5cm) \point(p7) {};
\draw (-1.3cm, 1.5cm) \point(p8) {};
\draw (-.7cm, 1.5cm) \point(p9) {};
\draw (-.3cm, 1.5cm) \point(p10) {};
\draw (.3cm, 1.5cm) \point(p11) {};
\draw (.7cm, 1.5cm) \point(p12) {};
\draw (1.3cm, 1.5cm) \point(p13) {};
\draw (1.7cm, 1.5cm) \point(p14) {};

\node [below] at (p0) {читатель ($i=0$)};
\node [left] at (p1) {мама ($i = 1$)};
\node [right] at (p2) {папа};
\node [left] at (p3) {($i=2$)};
\node [left] at (p7) {($i=3$)};

\draw (p0) -- (p1);
\draw (p0) -- (p2);
\draw (p1) -- (p3);
\draw (p1) -- (p4);
\draw (p2) -- (p5);
\draw (p2) -- (p6);
\draw (p3) -- (p7);
\draw (p3) -- (p8);
\draw (p4) -- (p9);
\draw (p4) -- (p10);
\draw (p5) -- (p11);
\draw (p5) -- (p12);
\draw (p6) -- (p13);
\draw (p6) -- (p14);
\end{tikzpicture}
\caption{Генеалогическое дерево}
\end{figure}

Сравнение общего количества людей на земле с количеством предков даёт нам понять, что исходя из принципа Дирихле некоторые вершины этого дерева неминуемо должны совпасть, поскольку людей на земле за 1000 лет жило меньше, чем это дерево могло бы иметь вершин в случае, если бы приведённое утверждение было ложным. Это ровно то, что требовалось доказать.
\end{example}

\begin{example}
Мистер и миссис Смит пригласили к себе в гости четыре пары. Некоторые из приглашённых были друзьями мистера Смита, а некоторые друзьями миссис Смит. Когда гости прибыли, те, кто знали друг друга ранее, пожали руки. Когда всё это произошло мистер Смит говорит: <<Как интересно! Если не считать меня, то здесь никто не поздоровался за руку одинаковое количество раз>>. Вопрос: сколько раз пожала руку миссис Смит?

На первый взгляд задача кажется абсолютно нерешаемой. Тем не менее, проявив стойкость, мы можем её решить опять же с помощью всё того же принципа Дирихле. Начинает задача поддаваться решению, если мы изобразим её в виде графа.

\begin{figure}[h]
\centering
\begin{tikzpicture}
\def\point{node [circle, draw, fill, inner sep = 0, minimum size = .1cm] }
\draw (-1.76cm, 2.42cm) \point (smith) {};
\draw (0, 3cm) \point (p8) {};
\draw (1.76cm, 2.43cm) \point (p7) {};
\draw (2.85cm, 0.93cm) \point (p6) {};
\draw (2.85, -0.93cm) \point (p5) {};
\draw (1.76cm, -2.43cm) \point (p4) {};
\draw (0, -3cm) \point (p3) {};
\draw (-1.76cm, -2.43cm) \point(p2) {};
\draw (-2.85cm, -.93cm) \point(p1) {};
\draw (-2.85cm, .93cm) \point(p0) {};

\node [left] at (smith) {м.Смит};
\node [above] at (p8) {8};
\node [above] at (p7) {7};
\node [above] at (p6) {6};
\node [above] at (p5) {5};
\node [above] at (p4) {4};
\node [above] at (p3) {3};
\node [above] at (p2) {2};
\node [above] at (p1) {1};
\node [above] at (p0) {0};

\end{tikzpicture}
\caption{Граф гостей четы Смит}
\end{figure}

Каждый человек на вечеринке у нас будет представлен отдельной вершиной. Ребра графа будут соответствовать рукопожатиям. Семейные пары будем выделять рамкой. На начальном этапе нам известно лишь, что все присутствующие кроме мистера Смита совершили различное количество рукопожатий. Максимальное количество рукопожатий, которые могло быть совершено~--- 8 (всего десять гостей, причём со своим спутником никто не здоровается, отсюда максимум восемь рукопожатий). Поэтому все вершины мы можем пронумеровать числами от 0 до 8, и одну вершину мы обозначим просто как Смит~--- мы не знаем сколько рукопожатий он совершил. Самих гостей мы будем нумеровать так же, то есть когда мы будем говорить фразу <<пятый гость>>, то мы будем подразумевать гостя, который совершил пять рукопожатий. Получившийся граф представлен на рис.~3.4.

\begin{figure}[h]
\centering
\begin{tikzpicture}
\def\point{node [circle, draw, fill, inner sep = 0, minimum size = .1cm] }
\draw (-1.76cm, 2.42cm) \point (smith) {};
\draw (0, 3cm) \point (p8) {};
\draw (1.76cm, 2.43cm) \point (p7) {};
\draw (2.85cm, 0.93cm) \point (p6) {};
\draw (2.85, -0.93cm) \point (p5) {};
\draw (1.76cm, -2.43cm) \point (p4) {};
\draw (0, -3cm) \point (p3) {};
\draw (-1.76cm, -2.43cm) \point(p2) {};
\draw (-2.85cm, -.93cm) \point(p1) {};
\draw (-2.85cm, .93cm) \point(p0) {};

\node [left] at (smith) {м.Смит};
\node [above] at (p8) {8};
\node [above] at (p7) {7};
\node [above] at (p6) {6};
\node [above] at (p5) {5};
\node [right] at (p4) {4};
\node [below] at (p3) {3};
\node [left] at (p2) {2};
\node [above] at (p1) {1};
\node [above] at (p0) {0};

\draw (p8) -- (smith);
\draw (p8) -- (p1);
\draw (p8) -- (p2);
\draw (p8) -- (p3);
\draw (p8) -- (p4);
\draw (p8) -- (p5);
\draw (p8) -- (p6);
\draw (p8) -- (p7);

\draw[dashed] (0, 3.2cm) -- (.4cm, 2.8cm) -- (-2.9cm, .68cm) -- (-3.3cm, .92cm)  -- cycle;
\end{tikzpicture}
\caption{Граф гостей четы Смит}
\end{figure}

Рассмотрим поближе 8-го гостя. Он не поздоровался лишь с одним человеком с одной стороны, и с другой стороны он очевидно не здоровался со своим спутником. Так же мы знаем точно, что он не здоровался с нулевым гостем, так как нулевой гость не совершил вообще ни одного рукопожатия. Соответственно нулевой гость и есть его спутник. Со всеми остальными гостями он поздоровался. Полученный результат изображён на рисунке~3.5.

\begin{figure}[h]
\centering
\begin{tikzpicture}
\def\point{node [circle, draw, fill, inner sep = 0, minimum size = .1cm] }
\draw (-1.76cm, 2.42cm) \point (smith) {};
\draw (0, 3cm) \point (p8) {};
\draw (1.76cm, 2.43cm) \point (p7) {};
\draw (2.85cm, 0.93cm) \point (p6) {};
\draw (2.85, -0.93cm) \point (p5) {};
\draw (1.76cm, -2.43cm) \point (p4) {};
\draw (0, -3cm) \point (p3) {};
\draw (-1.76cm, -2.43cm) \point(p2) {};
\draw (-2.85cm, -.93cm) \point(p1) {};
\draw (-2.85cm, .93cm) \point(p0) {};

\node [left] at (smith) {м.Смит};
\node [above] at (p8) {8};
\node [above] at (p7) {7};
\node [above] at (p6) {6};
\node [above] at (p5) {5};
\node [right] at (p4) {4};
\node [below] at (p3) {3};
\node [left] at (p2) {2};
\node [above] at (p1) {1};
\node [above] at (p0) {0};

\draw (p8) -- (smith);
\draw (p8) -- (p1);
\draw (p8) -- (p2);
\draw (p8) -- (p3);
\draw (p8) -- (p4);
\draw (p8) -- (p5);
\draw (p8) -- (p6);
\draw (p8) -- (p7);

\draw (p7) -- (smith);
\draw (p7) -- (p2);
\draw (p7) -- (p3);
\draw (p7) -- (p4);
\draw (p7) -- (p5);
\draw (p7) -- (p6);

\draw[dashed] (0, 3.2cm) -- (.4cm, 2.8cm) -- (-2.9cm, .68cm) -- (-3.3cm, .92cm)  -- cycle;
\draw[dashed] (1.76cm, 3cm) -- (2.5cm, 2.5cm) -- (-3cm, -1.3cm) -- (-3.2cm, -.65cm) -- cycle;

\end{tikzpicture}
\caption{Граф гостей четы Смит}
\end{figure}

Теперь рассмотрим 7-го гостя. Он не поздоровался за руку с двумя гостями, один из которых~--- его партнёр, а вторым должен быть нулевой гость (нулевой гость не может быть партнёром 7-го гостя, так как мы уже выяснили, что нулевой и восьмой гости образуют пару). Глядя на граф мы так же видим, что первый гость поздоровался с восьмым гостем, но так как нам известно, что он в принципе поздоровался лишь с одним человеком, то он не мог поздороваться с седьмым гостем. Значит, первый и седьмой гости образуют пару, и седьмой гость поздоровался со всеми кроме нулевого и первого гостя. Это отображено на рисунке~3.6.

\begin{figure}[h]
\centering
\begin{tikzpicture}
\def\point{node [circle, draw, fill, inner sep = 0, minimum size = .1cm] }
\draw (-1.76cm, 2.42cm) \point (smith) {};
\draw (0, 3cm) \point (p8) {};
\draw (1.76cm, 2.43cm) \point (p7) {};
\draw (2.85cm, 0.93cm) \point (p6) {};
\draw (2.85, -0.93cm) \point (p5) {};
\draw (2cm, -2.8cm) \point (p4) {};
\draw (0, -3cm) \point (p3) {};
\draw (-1.76cm, -2.43cm) \point(p2) {};
\draw (-2.85cm, -.93cm) \point(p1) {};
\draw (-2.85cm, .93cm) \point(p0) {};

\node [left] at (smith) {м.Смит};
\node [above] at (p8) {8};
\node [above] at (p7) {7};
\node [above] at (p6) {6};
\node [right] at (p5) {5};
\node [right] at (p4) {4};
\node [below] at (p3) {3};
\node [left] at (p2) {2};
\node [above] at (p1) {1};
\node [above] at (p0) {0};

\draw (p8) -- (smith);
\draw (p8) -- (p1);
\draw (p8) -- (p2);
\draw (p8) -- (p3);
\draw (p8) -- (p4);
\draw (p8) -- (p5);
\draw (p8) -- (p6);
\draw (p8) -- (p7);

\draw (p7) -- (smith);
\draw (p7) -- (p2);
\draw (p7) -- (p3);
\draw (p7) -- (p4);
\draw (p7) -- (p5);
\draw (p7) -- (p6);

\draw (p6) -- (smith);
\draw (p6) -- (p3);
\draw (p6) -- (p4);
\draw (p6) -- (p5);

\draw (p5) -- (smith);
\draw (p5) -- (p4);

\draw[dashed] (0, 3.2cm) -- (.4cm, 2.8cm) -- (-2.9cm, .68cm) -- (-3.3cm, .92cm)  -- cycle;
\draw[dashed] (1.76cm, 3cm) -- (2.5cm, 2.5cm) -- (-3cm, -1.3cm) -- (-3.2cm, -.65cm) -- cycle;
\draw[dashed] (2.85cm, 1.4cm) -- (3.3cm, 0.9cm) -- (-2.2cm, -3cm) -- (-2.26cm, -2cm) -- cycle;
\draw[dashed] (3cm, -0.5cm) -- (3.3cm, -1.1cm) -- (-.02cm, -3.5cm) -- (-.43cm, -2.5cm) -- cycle;

\end{tikzpicture}
\caption{Граф гостей четы Смит}
\end{figure}

Совершенно аналогичным образом мы можем показать, что шестой гость не здоровался с госями 0, 1 и 2 и что 2-ой гость является его спутником. Отсюда можно аналогично получить, что пятый гость не здоровался с гостями 0, 1, 2 и 3, и что третий гость является его спутником. Результат представлен на рисунке~3.7

Теперь мы нашли пару для всех людей, кроме четвёртого. Единственная возможная пара для четвёртого человека~--- это мистер Смит, поэтому четвёртый человек и есть миссис Смит, и она пожала руку ровно четырём людям.
\end{example}

Для последнего упражнения этого параграфа опять введём новую нотацию: будем обозначать через $a\Mod b$ остаток от деления $a$ на $b$.

\begin{exercise}
Пусть $n$ и $m$~--- взаимопростые числа и пусть нам известно, что
$$x\Mod n = a$$
$$x\Mod m = b$$
Докажите используя принцип Дирихле, что это уравнение всегда имеет ровно одно решение $x$, меньшее $mn$.
\end{exercise}
